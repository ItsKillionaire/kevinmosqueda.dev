---
import ProjectCard from './ProjectCard.astro';

// Fetch all pinned projects
const response = await fetch('https://pinned.berrysauce.dev/get/ItsKillionaire');
const allProjects = (await response.json()).map(p => ({...p, repo: p.name.trim(), link: `https://github.com/${p.author}/${p.name}`, image: `https://opengraph.githubassets.com/1/${p.author}/${p.name}`, language: p.language, languageColor: p.languageColor}));

const sortedProjects = allProjects.slice(0, 3);
---

<section id="projects" class="fade-in-up">
  <div class="container">
    <h2 class="heading">=> Selected Work</h2>
    <div class="projects-grid">
      {sortedProjects.map((project, index) => (
        <ProjectCard
          name={project.repo}
          description={String(project.description || '').trim()}
          url={project.link}
          language={String(project.language || 'N/A').trim()}
          languageColor={project.languageColor || '#000000'}
          image={project.image}
          index={index}
        />
      ))}
    </div>
  </div>
</section>

<style>
  #projects {
    padding: 6rem 2rem;
    background-color: var(--color-background-primary);
    color: var(--color-text-primary);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .heading {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 2.5rem;
    color: var(--color-accent);
    margin-bottom: 4rem;
    text-align: center;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }
</style>
